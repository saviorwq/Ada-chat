# 插件安全基线 / Plugin Security Baseline

本文档描述 Ada Chat 对插件机制的默认安全边界，帮助维护者与插件作者在开源协作中保持一致。

## 目标
- 在保留插件扩展能力的前提下，减少误配置和恶意插件对主流程的影响。
- 让“插件可扩展”与“主程序可控”同时成立。

## 当前基线规则
- **默认禁用新插件**：首次注册的插件默认不启用，需要用户在插件管理中手动开启。
- **钩子白名单**：仅允许 `beforeBuildRequest`、`beforeSend`、`afterResponse` 三类钩子。
- **钩子超时保护**：插件钩子有执行超时，防止阻塞请求链路。
- **异常自动熔断**：连续执行异常的插件会被自动禁用，避免持续影响系统稳定性。
- **插件元信息转义**：插件名称、作者、描述等信息会在 UI 侧安全转义后渲染。
- **加载路径校验**：插件目录名和资产文件名需要通过规则校验，且通过目录边界检查阻止越界加载。

## 对插件作者的建议
- 仅声明并实现需要的钩子，不要依赖未公开的内部对象。
- 保持钩子逻辑轻量，避免长时间阻塞网络请求。
- 在插件内自行做好异常捕获与降级，避免影响主程序。
- 避免把敏感配置写入前端可见区域；优先使用服务端存储接口。

## 对维护者的建议
- 合并插件 PR 前，至少检查：钩子使用、请求改写、外部网络调用、存储读写范围。
- 保持“最小可用权限”原则：新扩展点默认受限，再按场景放开。
- 发布版本时同步更新 `README` 与更新日志，确保行为变化可追溯。
